<h2 mat-dialog-title>Comandar - {{ table?.clave }}</h2>

<div mat-dialog-content>
  @if (products) {
    <div style="display: grid; grid-template-columns: 1fr 1fr 2fr 2fr; gap: 16px; height: 60vh;">
      <div style="display: flex; flex-direction: column;">
        <label style="margin-bottom: 8px; font-weight: 500;">Clasificaci√≥n</label>
        <mat-selection-list [multiple]="false" style="flex: 1; overflow-y: auto;">
          @for (class of products | groupBy : 'clasificacion'; track class.key) {
            <mat-list-option [selected]="activeClass == class"
              (click)="activeClass = class; activeGroup = undefined">
              {{ class.key }}
            </mat-list-option>
          }
        </mat-selection-list>
      </div>

      <div style="display: flex; flex-direction: column;">
        <label style="margin-bottom: 8px; font-weight: 500;">Grupo</label>
        <mat-selection-list [multiple]="false" style="flex: 1; overflow-y: auto;">
          @for (group of activeClass?.value | groupBy : 'grupo'; track group.key) {
            <mat-list-option [selected]="activeGroup == group" (click)="activeGroup = group">
              {{ group.key }}
            </mat-list-option>
          }
        </mat-selection-list>
      </div>

      <div style="display: flex; flex-direction: column;">
        <label style="margin-bottom: 8px; font-weight: 500;">Producto</label>
        <mat-nav-list style="flex: 1; overflow-y: auto;">
          @for (product of activeGroup?.value | orderBy : 'nombre'; track product.idpvPlatillos) {
            <mat-list-item (click)="selectProduct(product)" style="position: relative; cursor: pointer;">
              <span [style.background-color]="product.color"
                style="position: absolute; top: 0; height: 100%; left: 0; width: 4px;"></span>
              <span style="padding-left: 8px;">{{ product.nombre }}</span>
            </mat-list-item>
          }
        </mat-nav-list>
      </div>

      <div style="display: flex; flex-direction: column;">
        <label style="margin-bottom: 8px; font-weight: 500;">Comanda</label>
        <mat-nav-list style="flex: 1; overflow-y: auto;">
          @for (order of orders; track $index) {
            <mat-list-item (click)="selectOrder(order)" style="cursor: pointer;">
              <div style="display: flex; align-items: center; width: 100%;">
                <strong style="margin-right: 8px;">{{ order.cantidad }}</strong>
                <span style="flex: 1;">{{ order.nombre }}</span>
                <button mat-icon-button color="warn" (click)="removeOrder(order); $event.stopPropagation()">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-list-item>
          }
        </mat-nav-list>
      </div>
    </div>
  }
</div>

<mat-progress-bar [mode]="form.disabled ? 'indeterminate': 'determinate'"></mat-progress-bar>

<div mat-dialog-actions align="end">
  <div style="display: flex; align-items: center; gap: 8px; margin-right: auto;">
    <button mat-raised-button [color]="form.controls.copy.value ? 'primary' : undefined"
      (click)="form.controls.copy.setValue(!form.controls.copy.value)" [disabled]="form.controls.copy.disabled">
      Copia
    </button>
    <mat-form-field style="width: 200px;">
      <mat-label>Impresora</mat-label>
      <mat-select [formControl]="form.controls.printer">
        @for (p of printers; track p.idgeneralImpresoras) {
        <mat-option [value]="p.idgeneralImpresoras">{{ p.nombre }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <button matButton (click)="cancel()" [disabled]="form.disabled">Cancelar</button>
  <button matButton="filled" (click)="submit()" [disabled]="form.disabled">
    Comandar
  </button>
</div>
